# MongoDB Setup
- This is Henry Qin's attempt at documenting the setup of MongoDB
- These steps are in no way comprehensive. This is a brief overview of some steps that Henry had to go through to set up a local instance of MongoDB. These steps will certainly be missing some important steps that can hopefully be filled in through consultation of MongoDB's docs, PyMongo's docs, and StackOverflow.

# Setting Up an Account on MongoDB
[MongoDB: Getting Started](https://docs.mongodb.com/manual/tutorial/getting-started/) will be a very useful resource for this process.

- Go to http://cloud.mongo.com and sign up for a free-tier account for MongoDB Atlas is a cloud-hosted service for provisioning, running, monitoring, and maintaining MongoDB deployments.
- Create a new Atlas group.
- Create and deploy a new cluster. You will have to create an admin account. Make sure to save the admin username and password.
- Navigate to the security section, and whitelist your own IP and any other IPs that you want to have access to this cluster.
- On the Clusters view, Click the Connect button to view the URI Connection String.
Copy the connection string to the clipboard.
Paste the connection string somewhere and replace <PASSWORD> with the password for the user created earlier, and <DATABASE> with the name of the database to which you wish to connect.
Copy the modified URI to the clipboard.

# Installing MongoDB and its Dependencies
- Install MongoDB. In my case, I ran something along the lines of:
```brew install mongodb --with-openssl```
- Install the PyMongo package. The PyMongo package will allow us to access our MongoDB instances with Python scripts. In my case, I ran something along the lines of:
```sudo pip install pymongo```
- Install mongo-tools. This package gives us access to ``mongoimport``. ```mongoimport``` allows us to import files into MongoDB easily. In my case, I ran something along the lines of:
```sudo pip install mongo-tools```

# Starting MongoDB
- Start a MongoDB instance on your machine by running in the command line:
```mongod```

# Starting the Mongo Shell
- Start a Mongo shell instance on your machine (in a different bash process) by running in the command line:
```mongo```

# Working with Databases and Collections in the Mongo Shell
- Display the databases by running in the command line:
```show dbs```
- Display the collections by running in the command line:
```show collections```
- Set the db variable to a database instance:
```use <database>```

# Importing a CSV File into a Collecton in a Database
- Start a MongoDB instance on your machine by running in the command line:
```mongod```
- Running the following on the command line will import the csv file into the inputted collection of the inputted database. The fields of each of these documents (aka records) will be generated by the first line in the csv file due to the ```--headerline``` flag.  
```mongoimport --db <database> --collection <collection> --type csv --headerline --file <path to csv file>```
- Optionally, a ```--drop``` flag can be included to replace the specified collection with the imported documents (aka records) only.

# Interacting with the Database/Collection Using Python
- Import ```pymongo```
- Instantiate a MongoClient object with a URIString, or leave it blank to connect it to the default host/port:
```client = pymongo.MongoClient(URIString)```
- Instantiate an instance of a desired database:
```db = client.<database>```
- Instantiate an instance of the desired collection of the specified database
```collection = db.<collection>```
- Run a query on this database. Returns a cursor object, which is basically an iterator.
```query = collection.find(<query>)```
- Print out results of query with a for loop:
```for doc in query: print(doc)```

# Issues and Fixes
- Error with lock and write file:
```sudo chown -R `id -u` /data/db``` to resolve this issue
- Another instance of MongoDB is running:
```sudo killall -15 mongod```
- Contents of collection in Python script is 0 when you imported to the database locally:
Initialize your MongoClient with no arguments because then it will connect to the default host/port which is where the correct database is.


